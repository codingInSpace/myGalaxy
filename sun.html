<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title> Sol </title>
		<style>
			body { margin: 0; }
			canvas { width: 100%; height: 100% }
		</style>
	</head>
	<body>
		<script src="js/three.js"></script>

		<script src="js/TrackballControls.js"></script>
		
		<script>
			var scene = new THREE.Scene();
			scene.fog = new THREE.FogExp2( 0x000000, 0.002 );
			var camera = new THREE.PerspectiveCamera( 60, window.innerWidth/window.innerHeight, 0.1, 1000 );
			camera.position.z = 30;
			scene.add(camera);
			
			var renderer = new THREE.WebGLRenderer({ alpha: true, antialiasing: true });
			renderer.setSize( window.innerWidth, window.innerHeight );
			document.body.appendChild( renderer.domElement );

			//Skapar en grupp som ska innehålla hela scengrafen
			sceneGraph = new THREE.Object3D;
			
			
			var dirLight = new THREE.DirectionalLight( 0xffffff, 0.125 );
				dirLight.position.set( 0, -1, 0 ).normalize();
				scene.add( dirLight );

				dirLight.color.setHSL( 0.1, 0.7, 0.5 );

				// lens flares

				var textureFlare0 = THREE.ImageUtils.loadTexture( "textures/lensflare/lensflare0.png" );
				var textureFlare2 = THREE.ImageUtils.loadTexture( "textures/lensflare/lensflare2.png" );
				var textureFlare3 = THREE.ImageUtils.loadTexture( "textures/lensflare/lensflare3.png" );

				addLight( 0.55, 0.9, 0.5, 5000, 0, -1000 );
				addLight( 0.08, 0.8, 0.5,    0, 0, -1000 );
				addLight( 0.995, 0.5, 0.9, 5000, 5000, -1000 );

				function addLight( h, s, l, x, y, z ) {

					var light = new THREE.PointLight( 0xffffff, 1.5, 4500 );
					light.color.setHSL( h, s, l );
					light.position.set( x, y, z );
					scene.add( light );

					var flareColor = new THREE.Color( 0xffffff );
					flareColor.setHSL( h, s, l + 0.5 );

					var lensFlare = new THREE.LensFlare( textureFlare0, 700, 0.0, THREE.AdditiveBlending, flareColor );

					lensFlare.add( textureFlare2, 512, 0.0, THREE.AdditiveBlending );
					lensFlare.add( textureFlare2, 512, 0.0, THREE.AdditiveBlending );
					lensFlare.add( textureFlare2, 512, 0.0, THREE.AdditiveBlending );

					lensFlare.add( textureFlare3, 60, 0.6, THREE.AdditiveBlending );
					lensFlare.add( textureFlare3, 70, 0.7, THREE.AdditiveBlending );
					lensFlare.add( textureFlare3, 120, 0.9, THREE.AdditiveBlending );
					lensFlare.add( textureFlare3, 70, 1.0, THREE.AdditiveBlending );

					lensFlare.customUpdateCallback = lensFlareUpdateCallback;
					lensFlare.position.copy( light.position );

					scene.add( lensFlare );

				}


			 function lensFlareUpdateCallback( object ) {

				var f, fl = object.lensFlares.length;
				var flare;
				var vecX = -object.positionScreen.x * 2;
				var vecY = -object.positionScreen.y * 2;


				for( f = 0; f < fl; f++ ) {

					   flare = object.lensFlares[ f ];

					   flare.x = object.positionScreen.x + vecX * flare.distance;
					   flare.y = object.positionScreen.y + vecY * flare.distance;

					   flare.rotation = 0;

				}

				object.lensFlares[ 2 ].y += 0.025;
				object.lensFlares[ 3 ].rotation = object.positionScreen.x * 0.5 + THREE.Math.degToRad( 45 );

			}


			
			sunGroup =new THREE.Object3D;
			//***********************************
			var sunGeometry = new THREE.SphereGeometry( 5, 50, 50 );
			var sunMaterial = new THREE.MeshPhongMaterial({wireframe: false});
			
			sunMaterial.map    = THREE.ImageUtils.loadTexture('textures/suntexture.jpg');
			sunMaterial.bumpMap    = THREE.ImageUtils.loadTexture('textures/suntexture.jpg');
			sunMaterial.bumpScale = 0.06;
			sunMaterial.specular  = new THREE.Color('grey');
			
			var sunSphere = new THREE.Mesh( sunGeometry, sunMaterial );
			sunGroup.add( sunSphere);
			//***********************************

			
			
			
			galaxyGroup = new THREE.Object3D;
			//**********************************
			var galaxyGeometry = new THREE.SphereGeometry( 300, 32, 32 );
			var galaxyMaterial = new THREE.MeshPhongMaterial();
			
			galaxyMaterial.map    = THREE.ImageUtils.loadTexture('textures/space.png');
			//galaxyMaterial.specular  = new THREE.Color('grey');
			galaxyMaterial.side = THREE.DoubleSide;
			
			var galaxySphere = new THREE.Mesh( galaxyGeometry, galaxyMaterial );
		
			galaxyGroup.add( galaxySphere);
			//*********************************
			
			
	
			
			
			
			
			
			
			sceneGraph.add(galaxyGroup);
			//Lägger till grupper till scengraf
			galaxyGroup.add(sunGroup);
			
			
			//Lägger till scengraf till scen
			scene.add(sceneGraph);
			
			sceneGraph.rotation.x += 0.5;
			
			
			controls = new THREE.TrackballControls( camera );
			controls.zoomSpeed = 0.5;
			controls.panSpeed = 0;
			controls.rotateSpeed = 0.5;
			

			//Renderingsloop
			var render = function () {
				requestAnimationFrame( render );
				controls.update();

				renderer.render(scene, camera);
			};

			render();
		</script>
	</body>
</html>
